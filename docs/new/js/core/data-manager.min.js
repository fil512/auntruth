class DataManager{constructor(){this.cache=new Map,this.metadata=null,this.maxCacheSize=this.isMobile()?3:6,this.basePath="/auntruth/new/js/data/"}async getMetadata(){if(this.metadata)return this.metadata;try{const response=await fetch(`${this.basePath}metadata.json`);if(!response.ok)throw new Error(`HTTP ${response.status}`);return this.metadata=await response.json(),this.metadata}catch(error){return console.error("Failed to load metadata:",error),this.loadLegacyData()}}async getLineageData(lineageId){const cacheKey=`lineage-${lineageId}`;if(this.cache.has(cacheKey))return this.cache.get(cacheKey);try{const response=await fetch(`${this.basePath}lineages/L${lineageId}.json`);if(!response.ok)throw new Error(`HTTP ${response.status}`);const data=await response.json();return this.cache.set(cacheKey,data),this.maintainCacheSize(),data}catch(error){return console.error(`Failed to load lineage ${lineageId}:`,error),null}}async getPersonData(personId){const metadata=await this.getMetadata();if(!metadata||!metadata.personToLineage)return this.getPersonFromLegacy(personId);const lineageId=metadata.personToLineage[personId];if(!lineageId)return null;const lineageData=await this.getLineageData(lineageId);return lineageData?lineageData.people.find(person=>person.id===personId):null}async getPersonFromLegacy(personId){try{const legacyData=await this.loadLegacyData();return legacyData&&legacyData.people?legacyData.people.find(person=>person.id===personId):null}catch(error){return console.error("Failed to get person from legacy data:",error),null}}async searchPeople(query,options={}){if(!await this.getMetadata())return this.searchLegacyData(query);const searchTerm=query.toLowerCase(),results=[];for(const[key,lineageData]of this.cache)if(lineageData&&lineageData.people){const matches=lineageData.people.filter(person=>person.name.toLowerCase().includes(searchTerm));results.push(...matches)}return results}async searchLegacyData(query){try{const legacyData=await this.loadLegacyData();if(legacyData&&legacyData.people){const searchTerm=query.toLowerCase();return legacyData.people.filter(person=>person.name.toLowerCase().includes(searchTerm))}return[]}catch(error){return console.error("Failed to search legacy data:",error),[]}}maintainCacheSize(){if(this.cache.size>this.maxCacheSize){const oldestKey=this.cache.keys().next().value;this.cache.delete(oldestKey)}}async loadLegacyData(){try{const response=await fetch("/auntruth/new/js/data.json");if(!response.ok)throw new Error(`HTTP ${response.status}`);return await response.json()}catch(error){return console.error("Failed to load legacy data:",error),null}}isMobile(){return window.innerWidth<=768}}export default DataManager;window.DataManager=DataManager;