class NavigationComponent{constructor(){this.currentPage=this.detectCurrentPage(),this.currentLineage=this.detectCurrentLineage(),this.recentPages=this.loadRecentPages(),this.isNavigationInjected=!1,this.isMobile=window.innerWidth<=768,this.handleResize=this.handleResize.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.init()}init(){if(document.querySelector(".top-nav"))return this.isNavigationInjected=!0,void this.setupEventListeners();document.querySelector("main#main-content")?this.injectNavigationClean():this.injectNavigation(),this.highlightCurrentSection(),this.setupEventListeners(),this.setupMobileMenu(),this.saveCurrentPage()}detectCurrentPage(){const path=window.location.pathname,filename=path.split("/").pop()||"index.html";let pageType="unknown",pageId=null,title=document.title||"";return filename.startsWith("XF")?(pageType="person",pageId=filename.replace(".htm","").replace("XF","")):filename.startsWith("THF")?(pageType="thumbnail",pageId=filename.replace(".htm","").replace("THF","")):filename.startsWith("CX")?(pageType="context",pageId=filename.replace(".htm","").replace("CX","")):"index.htm"!==filename&&"index.html"!==filename||(pageType="index"),{path:path,filename:filename,pageType:pageType,pageId:pageId,title:title.replace("<br>AuntieRuth.com","").replace("AuntieRuth.com","").trim(),url:window.location.href}}detectCurrentLineage(){const lineageMatch=window.location.pathname.match(/\/L(\d+)\//);if(lineageMatch){const lineageNumber=lineageMatch[1];return{number:lineageNumber,name:{0:"All",1:"Hagborg-Hansson",2:"Nelson",3:"Pringle-Hambley",4:"Lathrop-Lothropp",5:"Ward",6:"Selch-Weiss",7:"Stebbe",8:"Lentz",9:"Phoenix-Rogerson"}[lineageNumber]||`Lineage ${lineageNumber}`,path:`/auntruth/new/htm/L${lineageNumber}/`}}return null}injectNavigation(){const topNav=this.createTopNavigation();document.body.insertAdjacentHTML("afterbegin",topNav);const existingContent=document.body.innerHTML;if(!document.querySelector(".main-content")){let contentStart=existingContent.indexOf("</nav>")+6;const beforeContent=existingContent.substring(0,contentStart),mainContent=existingContent.substring(contentStart);document.body.innerHTML=beforeContent+'<main class="main-content" role="main">'+mainContent+"</main>"}this.isNavigationInjected=!0}injectNavigationClean(){const topNav=this.createTopNavigation(),mainContent=document.querySelector("main#main-content, main.main-content");if(mainContent){console.log("Main content found, injecting top navigation only..."),document.body.insertAdjacentHTML("afterbegin",topNav);const header=mainContent.querySelector(".page-header, h1");header&&header.scrollIntoView({behavior:"instant",block:"start"})}this.isNavigationInjected=!0,setTimeout(()=>{console.log("Top navigation only - no sidebar to manage")},100)}createTopNavigation(){const currentPath=this.currentPage.path,basePath=currentPath.includes("/new/")?"/auntruth/new/":"/auntruth/htm/";return`\n            <nav class="top-nav" role="navigation" aria-label="Main navigation">\n                <div class="nav-container">\n                    <div class="nav-brand">\n                        <a href="${basePath}">AuntieRuth.com</a>\n                    </div>\n                    <ul class="nav-links">\n                        <li><a href="${basePath}" ${currentPath===basePath?'class="active"':""}>Home</a></li>\n                        <li class="nav-dropdown">\n                            <a href="#" class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">\n                                Lineages <span class="dropdown-arrow">▼</span>\n                            </a>\n                            <ul class="dropdown-menu" role="menu">\n                                <li><a href="${basePath}htm/L1/" role="menuitem">Hagborg-Hansson</a></li>\n                                <li><a href="${basePath}htm/L2/" role="menuitem">Nelson</a></li>\n                                <li><a href="${basePath}htm/L3/" role="menuitem">Pringle-Hambley</a></li>\n                                <li><a href="${basePath}htm/L4/" role="menuitem">Lathrop-Lothropp</a></li>\n                                <li><a href="${basePath}htm/L5/" role="menuitem">Ward</a></li>\n                                <li><a href="${basePath}htm/L6/" role="menuitem">Selch-Weiss</a></li>\n                                <li><a href="${basePath}htm/L7/" role="menuitem">Stebbe</a></li>\n                                <li><a href="${basePath}htm/L8/" role="menuitem">Lentz</a></li>\n                                <li><a href="${basePath}htm/L9/" role="menuitem">Phoenix-Rogerson</a></li>\n                                <li><a href="${basePath}htm/L0/" role="menuitem">All</a></li>\n                            </ul>\n                        </li>\n                        <li><a href="#" id="search-trigger" aria-haspopup="true">Search People</a></li>\n                        <li><a href="/auntruth/htm/">Original Site</a></li>\n                    </ul>\n                    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">\n                        ☰\n                    </button>\n                </div>\n            </nav>\n        `}setupEventListeners(){window.addEventListener("resize",this.handleResize),document.addEventListener("keydown",this.handleKeydown),this.setupDropdownMenu();const searchTrigger=document.getElementById("search-trigger");searchTrigger&&searchTrigger.addEventListener("click",e=>{e.preventDefault();const searchContainer=document.querySelector(".search-container"),searchInput=document.getElementById("people-search");searchContainer?(searchContainer.classList.toggle("active"),searchContainer.classList.contains("active")&&searchInput&&setTimeout(()=>searchInput.focus(),100)):console.log("Search container not found")})}setupDropdownMenu(){const dropdownToggle=document.querySelector(".dropdown-toggle"),dropdownMenu=document.querySelector(".dropdown-menu"),navDropdown=document.querySelector(".nav-dropdown");dropdownToggle&&dropdownMenu&&navDropdown&&(dropdownToggle.addEventListener("click",e=>{e.preventDefault();const isOpen=navDropdown.classList.contains("open");if(document.querySelectorAll(".nav-dropdown.open").forEach(dropdown=>{dropdown.classList.remove("open");const toggle=dropdown.querySelector(".dropdown-toggle");toggle&&toggle.setAttribute("aria-expanded","false")}),isOpen)navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false");else{navDropdown.classList.add("open"),dropdownToggle.setAttribute("aria-expanded","true");const firstMenuItem=dropdownMenu.querySelector("a");firstMenuItem&&setTimeout(()=>firstMenuItem.focus(),100)}}),document.addEventListener("click",e=>{navDropdown.contains(e.target)||(navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false"))}),dropdownMenu.addEventListener("keydown",e=>{const menuItems=dropdownMenu.querySelectorAll("a"),currentIndex=Array.from(menuItems).indexOf(document.activeElement);switch(e.key){case"ArrowDown":e.preventDefault();menuItems[(currentIndex+1)%menuItems.length].focus();break;case"ArrowUp":e.preventDefault();menuItems[currentIndex>0?currentIndex-1:menuItems.length-1].focus();break;case"Escape":e.preventDefault(),navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false"),dropdownToggle.focus();break;case"Tab":e.shiftKey&&0===currentIndex?(navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false")):e.shiftKey||currentIndex!==menuItems.length-1||(navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false"))}}),dropdownToggle.addEventListener("keydown",e=>{"Escape"===e.key&&(navDropdown.classList.remove("open"),dropdownToggle.setAttribute("aria-expanded","false"))}))}setupMobileMenu(){this.updateMobileState()}handleResize(){const wasMobile=this.isMobile;this.isMobile=window.innerWidth<=768,wasMobile!==this.isMobile&&this.updateMobileState()}updateMobileState(){}handleKeydown(e){}trapFocus(element){const focusableElements=element.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select');if(0===focusableElements.length)return;const firstElement=focusableElements[0],lastElement=focusableElements[focusableElements.length-1];element.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===firstElement&&(lastElement.focus(),e.preventDefault()):document.activeElement===lastElement&&(firstElement.focus(),e.preventDefault()))}),firstElement.focus()}highlightCurrentSection(){document.querySelectorAll(".nav-links a").forEach(link=>{link.href===window.location.href&&link.classList.add("active")})}loadRecentPages(){try{const stored=localStorage.getItem("auntieruth-recent-pages");return stored?JSON.parse(stored):[]}catch(e){return console.warn("Failed to load recent pages from localStorage:",e),[]}}saveCurrentPage(){try{const recentPages=this.loadRecentPages(),currentPage=this.currentPage,existingIndex=recentPages.findIndex(page=>page.url===currentPage.url);existingIndex>-1&&recentPages.splice(existingIndex,1),recentPages.unshift({url:currentPage.url,title:currentPage.title,filename:currentPage.filename,timestamp:Date.now()});const trimmed=recentPages.slice(0,10);localStorage.setItem("auntieruth-recent-pages",JSON.stringify(trimmed))}catch(e){console.warn("Failed to save current page to localStorage:",e)}}}document.addEventListener("DOMContentLoaded",()=>{window.location.pathname.includes("/htm/")&&!window.location.pathname.includes("/new/")||new NavigationComponent}),window.NavigationComponent=NavigationComponent;